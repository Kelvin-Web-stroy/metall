<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Каталог — ГераМеталл</title>
  <meta name="description" content="Каталог металлопроката по прайсу: группы (как в прайсе), фильтры и поиск."/>

  <style>
    :root{
      --bg:#f3f4f6;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --card:#ffffff;
      --shadow:0 12px 28px rgba(17,24,39,.08);

      /* акцент под цветмет (медь/золото) */
      --c1:#ffcc66;
      --c2:#ff8a3d;
      --c3:#ff4b2e;
      --accent: linear-gradient(135deg, var(--c1), var(--c2), var(--c3));

      --max:1220px;
      --r:16px;
      --sans: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:var(--sans); background:var(--bg); color:var(--text);}
    a{color:inherit; text-decoration:none}
    .container{max-width:var(--max); margin:0 auto; padding:0 18px}

    /* header like main */
    header{background:#fff; border-bottom:1px solid var(--border); position:sticky; top:0; z-index:60;}
    .head{display:flex; align-items:center; gap:14px; padding:14px 0; flex-wrap:wrap;}
    .brand{display:flex; align-items:center; gap:12px; min-width: 200px;}
    .logo{width:38px;height:38px;border-radius:14px;background:var(--accent); box-shadow:0 10px 18px rgba(255,138,61,.18);}
    .brand .name{font-weight:900; letter-spacing:.2px; line-height:1.05;}
    .brand .tag{display:block; font-size:12px; color:var(--muted); font-weight:700; margin-top:2px;}
    .catalog-btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:12px 14px; border-radius:12px;
      border:1px solid var(--border);
      background:#111827; color:#fff;
      font-weight:850; cursor:pointer; user-select:none;
      flex:0 0 auto;
    }
    .catalog-btn .burger{width:18px;height:12px; position:relative; display:inline-block;}
    .catalog-btn .burger:before,.catalog-btn .burger:after,.catalog-btn .burger i{
      content:""; position:absolute; left:0; right:0; height:2px; background:#fff; border-radius:3px;
    }
    .catalog-btn .burger:before{top:0}
    .catalog-btn .burger i{top:5px}
    .catalog-btn .burger:after{bottom:0}

    .searchbar{flex:1 1 auto; display:flex; gap:10px; align-items:center; min-width:260px;}
    .searchbar input{
      width:100%; border:1px solid var(--border); background:#f9fafb;
      border-radius:12px; padding:14px 14px; font-size:14px; outline:none;
    }
    .searchbar button{
      border:0; border-radius:12px; padding:14px 16px;
      font-weight:900; background:var(--accent); color:#111827;
      cursor:pointer; box-shadow:0 10px 18px rgba(17,24,39,.10); white-space:nowrap;
    }
    .head-right{display:flex; align-items:center; gap:12px; flex:0 0 auto;}
    .link{color:var(--muted); font-weight:750; font-size:13px}
    .link:hover{color:#111827}
    .phone{font-weight:900; white-space:nowrap}

    /* layout */
    .wrap{padding:18px 0 26px;}
    .grid{display:grid; grid-template-columns: 340px 1fr; gap:14px; align-items:start;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} .brand{min-width:unset} }

    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--r); box-shadow:var(--shadow);}
    .side{padding:14px; position:sticky; top:82px; max-height: calc(100vh - 110px); overflow:auto;}
    @media (max-width: 980px){ .side{position:relative; top:auto; max-height:none} }

    .h1{font-size:28px; font-weight:950; margin:0 0 8px; letter-spacing:-.3px;}
    .sub{margin:0 0 12px; color:var(--muted); line-height:1.6; font-weight:650;}
    .label{display:block; font-size:12px; font-weight:850; color:var(--muted); margin:10px 0 6px;}
    .select, .input{
      width:100%; border:1px solid var(--border); background:#f9fafb;
      border-radius:12px; padding:12px 12px; font-size:14px; outline:none;
    }
    .filters{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    @media (max-width: 520px){ .filters{grid-template-columns:1fr} }
    .pill{
      display:inline-flex; align-items:center; justify-content:center;
      padding:6px 10px; border-radius:999px;
      background:#fff; border:1px solid var(--border);
      font-weight:900; color:#111827;
    }
    .muted{color:var(--muted)}
    .navcats a{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; padding:10px 10px;
      border-radius:12px; border:1px solid transparent;
      color:#111827; font-weight:750;
    }
    .navcats a:hover{background:#f9fafb; border-color:var(--border)}
    .navcats small{color:var(--muted); font-weight:750}
    .sep{border:none; border-top:1px solid var(--border); margin:12px 0}

    /* table */
    .content{padding:14px;}
    .section{margin-top:14px;}
    .sec-head{display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-bottom:10px;}
    .sec-title{margin:0; font-size:18px; font-weight:950; letter-spacing:-.2px;}
    .sec-meta{color:var(--muted); font-weight:750}
    .table-wrap{overflow:auto; border-radius:16px; border:1px solid var(--border); background:#fff;}
    table{width:100%; border-collapse:separate; border-spacing:0; min-width: 920px;}
    th, td{padding:10px 10px; border-bottom:1px solid var(--border); vertical-align:top; font-size:14px;}
    th{position:sticky; top:0; background:#f9fafb; text-align:left; color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.35px;}
    tr:last-child td{border-bottom:none}
    td.mono{font-family:var(--mono); font-variant-numeric: tabular-nums;}
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--border); background:#fff;
      font-weight:850; color:#111827; font-size:12px;
      white-space:nowrap;
    }

    footer{margin-top:22px; background:#fff; border-top:1px solid var(--border);}
    .foot{padding:18px 0 26px; display:grid; grid-template-columns:1.2fr .8fr; gap:14px; color:var(--muted); font-size:13px;}
    @media (max-width: 980px){ .foot{grid-template-columns:1fr} }
    .foot b{color:#111827}
  </style>
</head>

<body>

<header>
  <div class="container">
    <div class="head">
      <a class="brand" href="index.html">
        <span class="logo" aria-hidden="true"></span>
        <span class="name">ГераМеталл<span class="tag">каталог по прайсу</span></span>
      </a>

      <a class="catalog-btn" href="catalog.html" title="Каталог">
        <span class="burger"><i></i></span>
        Каталог
      </a>

      <form class="searchbar" onsubmit="return goSearch(event)">
        <input id="topSearch" placeholder="Поиск: группа / профиль / марка / размер (например: ГОСТ 3262, 15 х 2.8, 08кп…)" />
        <button type="submit">Найти</button>
      </form>

      <div class="head-right">
        <a class="link" href="index.html#contacts">Контакты</a>
        <a class="phone" href="tel:+79000000000">+7 (900) 000-00-00</a>
      </div>
    </div>
  </div>
</header>

<main class="container wrap">
  <div class="grid">
    <aside class="card side">
      <div class="h1">Каталог</div>
      <p class="sub">Группы берутся из прайса (строки с синим заголовком). Поиск и фильтры — для быстрого подбора.</p>

      <label class="label">Поиск</label>
      <input id="q" class="input" placeholder="Например: труба оцинк, 89 х 3.5, 16523-97…" />

      <label class="label">Группа</label>
      <select id="cat" class="select"></select>

      <div class="filters" style="margin-top:10px">
        <div>
          <label class="label" style="margin-top:0">Цена от, ₽/т</label>
          <input id="pmin" class="input" inputmode="numeric" placeholder="например 90000"/>
        </div>
        <div>
          <label class="label" style="margin-top:0">Цена до, ₽/т</label>
          <input id="pmax" class="input" inputmode="numeric" placeholder="например 120000"/>
        </div>
      </div>

      <hr class="sep"/>
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <b>Найдено</b>
        <span id="count" class="pill">—</span>
      </div>
      <div class="muted" style="margin-top:8px; font-size:12.5px; line-height:1.5">
        Цены: до 0,3 т / 0,3–1 т / 1–5 т. Если нужна резка/доставка — укажи в запросе.
      </div>

      <hr class="sep"/>
      <div style="display:flex; align-items:center; justify-content:space-between">
        <b>Навигация по группам</b>
      </div>
      <div id="nav" class="navcats" style="margin-top:8px"></div>
    </aside>

    <section class="card content">
      <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap">
        <div>
          <div style="font-size:22px; font-weight:950; letter-spacing:-.2px">Товары и цены</div>
          <div class="muted" style="margin-top:6px; line-height:1.55">
            Данные подтягиваются из <b>products.json</b>. Обновите файл — каталог обновится.
          </div>
        </div>
        <a href="index.html#request" class="tag">Запросить счёт →</a>
      </div>

      <div id="out" class="section"></div>
    </section>
  </div>
</main>

<footer>
  <div class="container foot">
    <div>
      <b>ГераМеталл</b><br/>
      <div class="small">Каталог по прайсу. Для актуального наличия и сроков — запросите счёт.</div>
      <div class="small">© <span id="y"></span></div>
    </div>
    <div>
      <b>Контакты</b><br/>
      <a href="tel:+79000000000">+7 (900) 000-00-00</a> · <a href="mailto:sales@gerametal.ru">sales@gerametal.ru</a><br/>
      <span>Ваш город, ул. Примерная, 10</span>
    </div>
  </div>
</footer>

<script>
  document.getElementById('y').textContent = new Date().getFullYear();

  const fmtInt = (n) => (n===null || n===undefined || n==="" ? "" : new Intl.NumberFormat('ru-RU').format(n));
  const fmtMoney = (n) => (n===null || n===undefined || n==="" ? "" : new Intl.NumberFormat('ru-RU', {maximumFractionDigits: 2}).format(n));

  function slugify(text){
    return (text || "").toString().trim().toLowerCase()
      .replace(/[^\p{L}\p{N}\s-]/gu, "")
      .replace(/\s+/g, "-")
      .slice(0, 80) || "cat";
  }

  function readHashSearch(){
    const h = (location.hash || "");
    if(h.startsWith("#search=")){
      try{ return decodeURIComponent(h.slice("#search=".length)); }
      catch(e){ return h.slice("#search=".length); }
    }
    return null;
  }

  function goSearch(e){
    e.preventDefault();
    const q = (document.getElementById('topSearch').value || "").trim();
    if(q) location.hash = "search=" + encodeURIComponent(q);
    document.getElementById('q').value = q;
    apply();
    return false;
  }

  let PRODUCTS = [];

  function rowMatches(p, q){
    if(!q) return true;
    const hay = (p.category+" "+p.profile+" "+p.size+" "+p.steel+" "+p.length_m).toLowerCase();
    return hay.includes(q.toLowerCase());
  }
  function withinPrice(p, min, max){
    const v = p.price_ton_to_0_3 ?? p.price_ton_0_3_1 ?? p.price_ton_1_5;
    if(v===null || v===undefined) return true;
    if(min && v < min) return false;
    if(max && v > max) return false;
    return true;
  }

  function renderSection(cat, list){
    const id = slugify(cat);
    const rows = list.map(p => `
      <tr>
        <td><span class="tag">${escapeHtml(p.profile || "—")}</span></td>
        <td class="mono">${escapeHtml(p.size || "—")}</td>
        <td class="mono">${escapeHtml(p.steel || "—")}</td>
        <td class="mono">${p.length_m ?? ""}</td>
        <td class="mono">${fmtInt(p.price_ton_to_0_3)}</td>
        <td class="mono">${fmtInt(p.price_ton_0_3_1)}</td>
        <td class="mono">${fmtInt(p.price_ton_1_5)}</td>
        <td class="mono">${p.weight_kg ?? ""}</td>
        <td class="mono">${fmtMoney(p.price_piece_rub)}</td>
      </tr>
    `).join("");

    return `
      <div class="card" style="box-shadow:none; border:1px solid var(--border); margin-top:14px" id="${id}">
        <div style="padding:14px 14px 0">
          <div class="sec-head">
            <h3 class="sec-title">${escapeHtml(cat)}</h3>
            <div class="sec-meta">${list.length} позиций</div>
          </div>
        </div>
        <div style="padding:0 14px 14px">
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Профиль</th>
                  <th>Размер</th>
                  <th>Марка</th>
                  <th>Длина</th>
                  <th>до 0,3 т (₽/т)</th>
                  <th>0,3–1 т (₽/т)</th>
                  <th>1–5 т (₽/т)</th>
                  <th>Вес 1 шт, кг</th>
                  <th>Цена 1 шт, ₽</th>
                </tr>
              </thead>
              <tbody>
                ${rows || `<tr><td colspan="9" class="muted">Нет позиций по фильтрам</td></tr>`}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    `;
  }

  function escapeHtml(str){
    return (str || "").toString()
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  function buildCategoryNav(catStats){
    const nav = document.getElementById('nav');
    nav.innerHTML = catStats.map(({cat,count}) => `
      <a href="#${slugify(cat)}" onclick="onNavClick(event,'${escapeAttr(cat)}')">
        <span>${escapeHtml(cat)}</span>
        <small>${count}</small>
      </a>
    `).join("");
  }

  function escapeAttr(s){
    return (s||"").toString().replaceAll("\\","\\\\").replaceAll("'","\'");
  }

  function onNavClick(e, cat){
    // если выбран фильтр по категории — просто скроллим
    e.preventDefault();
    document.getElementById('cat').value = cat;
    apply();
    setTimeout(() => {
      const el = document.getElementById(slugify(cat));
      if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
    }, 150);
    return false;
  }

  function apply(){
    const q = (document.getElementById('q').value || "").trim();
    const cat = (document.getElementById('cat').value || "");
    const min = parseInt((document.getElementById('pmin').value || "").replace(/\D/g,""), 10) || null;
    const max = parseInt((document.getElementById('pmax').value || "").replace(/\D/g,""), 10) || null;

    const filtered = PRODUCTS.filter(p =>
      (!cat || p.category === cat) &&
      rowMatches(p, q) &&
      withinPrice(p, min, max)
    );

    document.getElementById('count').textContent = filtered.length;

    // group by category (keep original order by first appearance)
    const order = [];
    const map = new Map();
    for(const p of filtered){
      if(!map.has(p.category)){ map.set(p.category, []); order.push(p.category); }
      map.get(p.category).push(p);
    }

    const out = document.getElementById('out');
    out.innerHTML = order.map(k => renderSection(k, map.get(k))).join("") || `
      <div class="card" style="padding:14px; box-shadow:none; border:1px solid var(--border)">
        <b>По текущим фильтрам ничего не найдено.</b>
        <div class="muted" style="margin-top:6px">Попробуйте убрать часть условий или изменить запрос.</div>
      </div>
    `;
  }

  async function main(){
    const res = await fetch('products.json', {cache:'no-store'});
    PRODUCTS = await res.json();

    // categories in original order
    const catOrder = [];
    const catCount = new Map();
    for(const p of PRODUCTS){
      if(!catCount.has(p.category)) catOrder.push(p.category);
      catCount.set(p.category, (catCount.get(p.category)||0) + 1);
    }
    const catStats = catOrder.map(cat => ({cat, count: catCount.get(cat)}));

    const catSel = document.getElementById('cat');
    catSel.innerHTML = `<option value="">Все группы</option>` + catOrder.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join("");

    buildCategoryNav(catStats);

    // hash search
    const hs = readHashSearch();
    if(hs){
      document.getElementById('q').value = hs;
      document.getElementById('topSearch').value = hs;
    }

    // listeners
    ["q","cat","pmin","pmax"].forEach(id => document.getElementById(id).addEventListener('input', apply));

    apply();

    // scroll to category if hash is category (not search)
    const h = (location.hash || "").slice(1);
    if(h && !h.startsWith("search=")){
      setTimeout(() => {
        const el = document.getElementById(h);
        if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
      }, 250);
    }
  }

  main();
</script>

</body>
</html>